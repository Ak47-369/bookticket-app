services:
  # 1. CONFIG SERVER
  - type: web
    name: config-server
    runtime: docker
    rootDir: platform/config-server
    plan: free
    envVars:
      - fromGroup: movie-app-secrets-prod
      - key: EUREKA_CLIENT_ENABLED
        value: "false"

  # 2. EUREKA SERVER (Service Registry)
  - type: web
    name: service-registry
    runtime: docker
    rootDir: platform/eureka-server
    plan: free
    envVars:
      - fromGroup: movie-app-secrets-prod
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: EUREKA_CLIENT_REGISTER_WITH_EUREKA
        value: "false"
      - key: EUREKA_CLIENT_FETCH_REGISTRY
        value: "false"
      - key: CONFIG_SERVER_URL
        value: https://config-server-f2t3.onrender.com
  # 3. API GATEWAY
  - type: web
    name: api-gateway
    runtime: docker
    rootDir: platform/api-gateway
    plan: free
    envVars:
      - fromGroup: movie-app-secrets-prod
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SPRING_CONFIG_IMPORT
        value: configserver:https://config-server-f2t3.onrender.com
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://service-registry-a48d.onrender.com/eureka/
      - key: JWT_SECRET
        sync: false
      - key: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "true"
      - key: API_GATEWAY_PUBLIC_URL
        value: https://api-gateway-mtiq.onrender.com

  # 4. USER SERVICE
  - type: web
    name: user-service
    runtime: docker
    rootDir: services/user-service
    plan: free
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SPRING_CONFIG_IMPORT
        value: configserver:https://config-server-f2t3.onrender.com
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://service-registry-a48d.onrender.com/eureka/
      - key: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "true"
      - key: NEON_DB
        sync: false
      - key: CONFIG_SERVER_URL
        value: https://config-server-f2t3.onrender.com

  # 5. MOVIE SERVICE
  - type: web
    name: movie-service
    runtime: docker
    rootDir: services/movie-service
    plan: free
    envVars:
      - fromGroup: movie-app-secrets-prod
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SPRING_CONFIG_IMPORT
        value: configserver:https://config-server-f2t3.onrender.com
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://service-registry-a48d.onrender.com/eureka/
      - key: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "true"
      - key: NEON_DB
        sync: false
      - key: CONFIG_SERVER_URL
        value: https://config-server-f2t3.onrender.com

  # 6. Theater Service
  - type: web
    name : theater-service
    runtime: docker
    rootDir: services/theater-service
    plan: free
    envVars:
      - fromGroup: movie-app-secrets-prod
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SPRING_CONFIG_IMPORT
        value: configserver:https://config-server-f2t3.onrender.com
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://service-registry-a48d.onrender.com/eureka/
      - key: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "true"
      - key: NEON_DB
        sync: false
      - key: CONFIG_SERVER_URL
        value: https://config-server-f2t3.onrender.com

  # 7. BOOKING SERVICE
  - type: web
    name: booking-service
    runtime: docker
    rootDir: services/booking-service
    plan: free
    envVars:
      - fromGroup: movie-app-secrets-prod
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SPRING_CONFIG_IMPORT
        value: configserver:https://config-server-f2t3.onrender.com
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://service-registry-a48d.onrender.com/eureka/
      - key: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "true"
      - key: NEON_DB
        sync: false
      - key: CONFIG_SERVER_URL
        value: https://config-server-f2t3.onrender.com

  # 8. PAYMENT SERVICE
  - type: web
    name: payment-service
    runtime: docker
    rootDir: services/payment-service
    plan: free
    envVars:
      - fromGroup: movie-app-secrets-prod
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SPRING_CONFIG_IMPORT
        value: configserver:https://config-server-f2t3.onrender.com
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://service-registry-a48d.onrender.com/eureka/
      - key: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "true"
      - key: NEON_DB
        sync: false
      - key: CONFIG_SERVER_URL
        value: https://config-server-f2t3.onrender.com

  # 9. NOTIFICATION SERVICE
  - type: web
    name: notification-service
    runtime: docker
    rootDir: services/notification-service
    plan: free
    envVars:
      - fromGroup: movie-app-secrets-prod
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SPRING_CONFIG_IMPORT
        value: configserver:https://config-server-f2t3.onrender.com
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://service-registry-a48d.onrender.com/eureka/
      - key: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "true"
      - key: NEON_DB
        sync: false
      - key: CONFIG_SERVER_URL
        value: https://config-server-f2t3.onrender.com
